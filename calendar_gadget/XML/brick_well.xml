<Module>
	<ModulePrefs title="The Brick Well" height="800" author_email="leigh765@me.com">
		<Require feature="google.calendar-0.5"/>
	</ModulePrefs>
	<Content type="html">
		<![CDATA[ 
			
				<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> 	
				<html> 
					<head><title>Test</title>
					<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.10/angular.min.js"></script>
					<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
					
					<script type='text/javascript' src='https://cdn.firebase.com/js/client/1.0.6/firebase.js'></script>

					<script type='text/javascript'
					        src='//cdn.firebase.com/js/simple-login/1.2.5/firebase-simple-login.js'>
					</script> 
					<script type='text/javascript'
					        src='//code.jquery.com/ui/1.10.4/jquery-ui.min.js'>
					</script> 
					
						<style>
							ul{padding: 0px 10px;}
							#brick_settings{overflow-y: scroll;height: 300px;}
							.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.ui-front.ui-dialog-buttons.ui-draggable.ui-resizable{background-color: white;border: thin solid #ccc;width: 160px;}
						</style>
					</head>
					<body ng-app> 
						<h5>Pick a erica</h5>
						<div id="dialog-register" title="Register new user">
						    <form>
						        <fieldset>
						            <label for="name">Email</label>
						            <input type="text" name="email" id="register-email" class="text ui-widget-content ui-corner-all" />
						            <label for="password">Password</label>
						            <input type="password" name="password" id="register-password" value="" class="text ui-widget-content ui-corner-all" />
						        </fieldset>
						    </form>
						</div>
						<div id="dialog-login" title="Login user">
						    <form>
						        <fieldset>
						            <label for="name">Email</label>
						            <input type="text" name="email" id="login-email" class="text ui-widget-content ui-corner-all" />
						            <label for="password">Password</label>
						            <input type="password" name="password" id="login-password" value="" class="text ui-widget-content ui-corner-all" />
						        </fieldset>
						    </form>
						</div>
						<button id="opener-register">Register</button>
						<button id="opener-login">Login</button>
						<button id="opener-logout">Logout</button>
						<br />
						<input id="data" />
						<!--add a variable for the view-->
						<p>Time for the week</p>
							<table>
								<thead><th>Actual</th><th>Est.</th></thead>
								<tbody><td></td><td><input type="text"  name="Ampliseq" /></td></tbody>
							</table>
						 <label>Ampliseq</label>
						 
						 <label>LUX</label>
						 <input type="text" name="LUX" />
						
						<div ng-controller="calendarCntrl" id="brick_settings">
							<input type="checkbox" ng-model="checked_projects">Show Projects</input> 
							<input type="checkbox" ng-model="checked_matrix">Show Matrix Options</input>
							<div ng-show="checked_projects">
								<p>add project</p>
							    <ul id="brick_projects">
							        <li ng-repeat="project in projects">
							          Name: <input ng-model="project.name">
							          [<a href ng-click="projects.splice($index, 1)">X</a>]
							        </li>
							        <li>
							          [<a href ng-click="projects.push({})">add</a>]
							        </li>
							    </ul>
							</div>
							<div ng-show="checked_matrix">
								<p>add phase</p>
							    <ul  id="brick_phases">
							        <li ng-repeat="phase in phases">
							          Name: <input ng-model="phase.name">
							          [<a href ng-click="phases.splice($index, 1)">X</a>]
							        </li>
							        <li>
							          [<a href ng-click="phases.push({})">add</a>]
							        </li>
							    </ul>

								<p>add offering</p>
							    <ul id="brick_tasks">
							        <li ng-repeat="offering in offerings">
							          Name: <input ng-model="offering.name">
							          [<a href ng-click="offerings.splice($index, 1)">X</a>]
							        </li>
							        <li>
							          [<a href ng-click="offerings.push({})">add</a>]
							        </li>
							    </ul> 
						    </div> 
						
							<div>
								Project:
								<span  >
								  <select ng-model="project" ng-options="pr.name for pr in projects">
								    <option value="">-- choose project --</option>
								  </select>
								</span><br/>

								Phase:
								<span  >
								  <select ng-model="phase" ng-options="p.name for p in phases">
								    <option value="">-- choose phase --</option>
								  </select>
								</span><br/>

								Offering:
								<span  >
								  <select ng-model="offering" ng-options="o.name for o in offerings">
								    <option value="">-- choose offering --</option>
								  </select>
								</span><br/>
							</div>
							<center> <button ng-click="event(phase, offering, project)">Add Brick</button> </center>
						</div>
						
						
						<script>
							var ref = new Firebase('https://brickplanner.firebaseio.com');
							myUser = -1;
							jQuery(function () {
							    jQuery("#dialog-register").dialog({
							        autoOpen: false,
							        buttons: {
							            "ok": function () {

							                var email = jQuery("#register-email").val();
							                var password = jQuery("#register-password").val();
							                authClient.createUser(email, password, function (error, user) {
							                    if (!error) {
							                        console.log('logging new registered user');
							                        doLogin(email, password);
							                    } else {
							                        alert(error);
							                    }
							                });

							                jQuery(this).dialog("close");
							            },
							            Cancel: function () {
							                jQuery(this).dialog("close");
							            }
							        }
							    });

							    jQuery("#dialog-login").dialog({
							        autoOpen: false,
							        buttons: {
							            "ok": function () {
							                console.log('trying to login: ' + jQuery("#login-email").val());

							                var email = jQuery("#login-email").val();
							                var password = jQuery("#login-password").val();

							                doLogin(email, password);
							                jQuery(this).dialog("close");
							            },
							            Cancel: function () {
							                jQuery(this).dialog("close");
							            }
							        }
							    });

							    jQuery("#opener-register").click(function () {
							        jQuery("#dialog-register").dialog("open");
							    });

							    jQuery("#opener-login").click(function () {
							        jQuery("#dialog-login").dialog("open");
							    });

							    jQuery("#opener-logout").click(function () {
							        authClient.logout();
							    });
							});

							function doLogin(email, password) {
							    authClient.login('password', {
							        email: email,
							        password: password
							    });
							};

							var authClient = new FirebaseSimpleLogin(ref, function (error, user) {
							    if (error) {
							        alert(error);
							        return;
							    }
							    if (user) {
							        // User is already logged in.
							        console.log('User ID: ' + user.id + ', Provider: ' + user.provider);
							        myUser = user;
							        // doLogin(user);
							        console.log('logged in')
							        jQuery("#data").attr('disabled', false);
							        jQuery("#opener-logout").attr('disabled', false);
							        jQuery("#opener-login").attr('disabled', true);
							    } else {
							        // User is logged out.
							        console.log('logged out');
							        jQuery("#data").attr('disabled', true);
							        jQuery("#opener-logout").attr('disabled', true);
							        jQuery("#opener-login").attr('disabled', false);
							        // ("#dialog-form").dialog("open");
							    }
							});



							jQuery('#data').keypress(function (e) {
							    if (e.keyCode == 13) {
							        var data = jQuery('#data').val();
							        console.log(myUser.id);
							        var myRef = new Firebase("https://brickplanner.firebaseio.com/users/" + myUser.id);
							        myRef.push({
							            data: data
							        });
							        jQuery('#data').val('');
							    }
							});

							function calendarCntrl($scope) {
							  $scope.offerings = [
							 	{name:'Meeting', value:"0"},
							 	{name:'Documentation', value:"1"},
							 	{name:'Interface Design', value:"2"},
							 	{name:'Visual Deisgn', value:"3"},
							    
							  ];

							  $scope.phases = [
							  	{name:'Admin', value:"0"},
							  	{name:'RFP', value:"1"},
							  	{name:'Inception', value:"2"},
							  	{name:'Implementation', value:"3"},
							  	{name:'Follow Up', value:"4"}
							     
							   ];
							   $scope.projects = [
							   	{name:'Ampliseq', value:"324"},
							   	{name:'LUX', value:"312"},
							   	{name:'USP', value:"313"},
							   	{name:'Marketing', value:"277"}
							      
							    ];
							   $scope.event = function(phase, offering, project) { 
								var location_add= project.value +"."+phase.value + offering.value;
								var title_add= project.value+"-"+project.name +": "+phase.name +" "+offering.name;
								var eventData = { 
									title: title_add, 
									details: 'details_add', 
									location: location_add, 
									allDay: false
									};
									
								google.calendar.composeEvent(eventData); 


								}
							 
							
							}

						</script>
					
				</body> 
				</html>

		]]>
	</Content>
</Module>

